!function(t,s){PostcodeAPI=function(n){this.settings={apiURL:"//api.thepostcodeapi.com/",endpoint:"components",addressButtonText:n.addressButtonText==s?"Select":n.addressButtonText,apiKey:n.apiKey==s?!1:n.apiKey,buttonText:n.buttonText==s?"Lookup Address":n.buttonText,buttonLoadingText:n.buttonLoadingText==s?"Loading":n.buttonLoadingText,buttonClass:n.buttonClass==s?[]:n.buttonClass,concatSeparator:n.concatSeparator==s?", ":n.concatSeparator,debug:n.debug==s?!0:n.debug,field:n.field==s?null:n.field,fields:n.fields==s?{line1:"line1+line2+line3",line2:"line4",line3:"line5+line6",town:"town",county:"county"}:n.fields,messageClass:n.messageClass==s?[]:n.messageClass,modal:n.modal==s?!0:n.modal,modalTitle:n.modalTitle==s?"Select Address:":n.modalTitle,selectId:n.selectId==s?"papi-select-address":n.selectId,selectClass:n.selectClassName==s?[]:n.selectClassName,type:n.type==s?"lightbox":n.type,txtNotFound:n.txtNotFound==s?"Postcode not found. Please try again":n.txtNotFound},this.init=function(){if(this.field=this.settings.field,null!==this.field){var s=this;this.button=document.createElement("button"),this.button.innerHTML=this.settings.buttonText,this._addClass(this.button,this.settings.buttonClass),this.button.onclick=function(i){e=i||t.event,e.preventDefault(),s.run(e)},this._insertAfter(this.button,this.field)}},this.run=function(){return this.queryVal=this._trim(this.field.value),document.getElementById("papi-message-box")!=s&&document.getElementById("papi-message-box").remove(),this.settings.apiKey?""==this.queryVal?(this.field.focus(),this._console("Postcode field was empty","error"),!1):this.validatePostcode(this.queryVal)?("lightbox"==this.settings.type?this.showLightbox():"select"==this.settings.type?this.showSelect():(this._console('Invalid selection type specified. Falling back to "lightbox"',"warn"),this.showLightbox()),!0):(this.field.focus(),this._console(postcode+" is not a valid UK postcode format","error"),this._message("Postcode is invalid","papi-error",this.button),!1):(this._console("You must specify an API key","error"),!1)},this.showLightbox=function(){var e=this;this.lightboxCover=document.createElement("div"),this.lightboxContainer=document.createElement("div"),this.lightboxContainer.id="papi-lightbox-container",this.lightboxCover.id="papi-lightbox-cover",this.lightboxContainer.className="papi-lightbox-loading",document.body.appendChild(this.lightboxCover),document.body.appendChild(this.lightboxContainer),this.settings.modal||(this.lightboxCover.onclick=function(){e.lightboxContainer.remove(),e.lightboxCover.remove()},t.onkeydown=function(t){27==t.keyCode&&(e.lightboxContainer.remove(),e.lightboxCover.remove())}),this._fetch(function(t){var s=JSON.parse(t);if(0==s.count)e.lightboxContainer.remove(),e.lightboxCover.remove(),e._message(e.settings.txtNotFound,"",e.button);else{var i=document.createElement("header"),n=document.createElement("h3"),o=e._generateSelect(s,20),a=document.createElement("button"),l=document.createElement("footer"),r=document.createElement("div");n.innerHTML=e.settings.modalTitle,a.innerHTML=e.settings.addressButtonText,i.appendChild(n),l.appendChild(a),r.className="papi-lightbox-content",r.appendChild(o),a.onclick=function(){return o.selectedIndex<0?void o.focus():(e.lightboxContainer.remove(),e.lightboxCover.remove(),void e._selectAddress(o))},e.lightboxContainer.appendChild(i),e.lightboxContainer.appendChild(r),e.lightboxContainer.appendChild(l)}})},this.showSelect=function(){null!==document.getElementById(this.settings.selectId)&&document.getElementById(this.settings.selectId).remove();var t=this;this.button.disabled="disabled",this.button.innerHTML=this.settings.buttonLoadingText,this._fetch(function(e){var s=JSON.parse(e);if(0==s.count)t._message(t.settings.txtNotFound,"",t.button),t.button.disabled=!1,t.button.innerHTML=t.settings.buttonText;else{var i=t._generateSelect(s,10);this._addClass(i,this.settings.selectClass),t._insertAfter(i,t.button),i.onchange=function(){t._selectAddress(this),this.remove()}}})},this.validatePostcode=function(t){return/^[A-Z]{1,2}[0-9]{1,2} ?[0-9][A-Z]{2}$/i.test(t)},this._selectAddress=function(t){var e=t.options[t.selectedIndex];for(var i in this.settings.fields){for(var n=this.settings.fields[i].split("+"),o="",a=0,l=n.length;l>a;a++){var r=e.getAttribute("data-"+n[a]);""!=r&&r!=s&&(o=""==o?r:o+r,o+=isNaN(parseInt(r))?this.settings.concatSeparator:" ")}var d=new RegExp(this.settings.concatSeparator+"$","g"),h=o.replace(d,"");this._getInput(i).value=h!=s?h:""}this.field.value=e.getAttribute("data-postcode")},this._generateSelect=function(t,e){var i=document.createElement("select");i.id=this.settings.selectId,i.className=this.settings.selectClassName,e!==s&&i.setAttribute("size",e);for(var n=0;n<t.count;n++){var o=t.results[n],a=document.createElement("option");a.innerHTML=o.formattedAddress,a.setAttribute("data-line1",o.line1),a.setAttribute("data-line2",o.line2),a.setAttribute("data-line3",o.line3),a.setAttribute("data-line4",o.line4),a.setAttribute("data-line5",o.line5),a.setAttribute("data-line6",o.line6),a.setAttribute("data-town",o.place.town),a.setAttribute("data-county",o.place.county),a.setAttribute("data-postcode",o.postcode),i.appendChild(a)}return i},this._fetch=function(t){i.request({url:this.settings.apiURL+this.settings.endpoint,method:"get",data:{key:this.settings.apiKey,postcode:this.queryVal}}).done(t)},this._getInput=function(t){return document.getElementsByName(t)[0]},this._insertAfter=function(t,e){console.log(e);var s=e.parentNode;s.lastchild==e?s.appendChild(t):s.insertBefore(t,e.nextSibling)},this._addClass=function(t,e){t!=s&&(t.className="object"==typeof e?e.join(" "):e)},this._trim=function(t){return t.replace(/\s/g,"")},this._message=function(t,e,s){var i=document.createElement("div");return i.attributes.className=e,i.id="papi-message-box",i.innerHTML=t,this._insertAfter(i,s),i},this._console=function(e,s){var i=function(){};t.console||(t.console={log:i,info:i,warn:i,debug:i,error:i}),this.settings.debug&&console[s](e)},this.init()};var i={request:function(e){"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{};var s=function(t,e){var s,i=[];for(var n in t)i.push(n+"="+encodeURIComponent(t[n]));return s=i.join("&"),""!=s?e?e.indexOf("?")<0?"?"+s:"&"+s:s:""},i={host:{},process:function(e){var i=this;return this.xhr=null,t.ActiveXObject?this.xhr=new ActiveXObject("Microsoft.XMLHTTP"):t.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==i.xhr.readyState&&200==i.xhr.status){var t=i.xhr.responseText;e.json===!0&&"undefined"!=typeof JSON&&(t=JSON.parse(t)),i.doneCallback&&i.doneCallback.apply(i.host,[t,i.xhr])}else 4==i.xhr.readyState&&i.failCallback&&i.failCallback.apply(i.host,[i.xhr]);i.alwaysCallback&&i.alwaysCallback.apply(i.host,[i.xhr])}),"get"==e.method?this.xhr.open("GET",e.url+s(e.data,e.url),!0):(this.xhr.open(e.method,e.url,!0),this.setHeaders({"X-Requested-With":"XMLHttpRequest","Content-type":"application/x-www-form-urlencoded"})),e.headers&&"object"==typeof e.headers&&this.setHeaders(e.headers),setTimeout(function(){"get"==e.method?i.xhr.send():i.xhr.send(s(e.data))},20),this},done:function(t){return this.doneCallback=t,this},fail:function(t){return this.failCallback=t,this},always:function(t){return this.alwaysCallback=t,this},setHeaders:function(t){for(var e in t)this.xhr&&this.xhr.setRequestHeader(e,t[e])}};return i.process(e)}}}(window,void 0);
